<project name="trac-xmlrpc" basedir="." xmlns:wtk="urn:net.sf.wtk.ant.dependencies" default="prepare">

	<import file="${basedir}/../net.sf.wtk.ant.dependencies/build.import.xml"/>
	<import file="${basedir}/../net.sf.wtk.ant.namespaces/build.import.xml"/>
	
	<property file="${basedir}/META-INF/MANIFEST.MF" prefix="mf"/>
	
	<property name="build" value="${basedir}${file.separator}build" />
	<property name="lib" value="${basedir}/lib" />
	<property name="jar" value="${build}${file.separator}${mf.Bundle-SymbolicName}_${mf.Bundle-Version}.jar" />

	<target name="clean" description="Removes all generated files.">
		<delete dir="${build}"/>
		<delete dir="${lib}" includes="*.jar, *.zip"/>
	</target>

	<target name="manifest">
		<mkdir dir="${build}/META-INF"/>
		<copy file="${basedir}/META-INF/MANIFEST.MF" tofile="${build}/META-INF/MANIFEST.MF"/>
		<manifest file="${build}/META-INF/MANIFEST.MF" mode="update">
			<attribute name="Bundle-ClassPath" value="."/>
		</manifest>
	</target>
		
	<target name="prepare" depends="namespace4ant.namespace4ant:taskdef-namespace4ant, manifest" description="Resolves external dependencies.">
		<namespace4ant/>
		
		<mkdir dir="${build}"/>
		
		<wtk:dependency
			url="http://trac-hacks.org/attachment/wiki/XmlRpcPlugin/trac_xml_rpc_example_java.zip?format=raw" 
			includes="org.lustin.trac_xml_rpc.jar" 
			filesetid="jar" />
		
		<copy todir="${lib}">
			<fileset refid="jar" />
			<mapper type="merge" to="${ant.project.name}.jar"/>
		</copy>
		
		<jar destfile="${jar}" manifest="${build}/META-INF/MANIFEST.MF">
			<zipgroupfileset dir="${lib}" includes="${ant.project.name}.jar"/>
		</jar>
		
		<fileset id="plugin" dir="${build}">
			<filename name="${mf.Bundle-SymbolicName}_${mf.Bundle-Version}.jar"/>
		</fileset>
	</target>
</project>
